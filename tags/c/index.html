<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <!-- Title -->
    
    <title>Tag: c# - Ira Mellor (dot) Com</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="canonical" href="https://iramellor.com/tags/c/"/>
    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="Ira Mellor">
    

    <!--Favicon-->
    
      <link rel="icon" href="/images/favicon.png">
    

    <!--Open Graph Title-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Ira Mellor (dot) Com"/>

    <!--Page Cover-->
    
        <meta property="og:image" content=""/>
    
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic" rel="stylesheet" type="text/css">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/main.min.css">


    
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    
<link rel="stylesheet" href="https://iramellor.com/css/highlight.min.css">

    

    <!--[if lt IE 8]>
        
<script src="/js/ie/html5shiv.js"></script>

    <![endif]-->

    <!--[if lt IE 8]>
        
<link rel="stylesheet" href="/css/ie8.min.css">

    <![endif]-->

    <script type="text/javascript">
        // post load scripts helper
        var _scriptsToPostLoad = window._scriptsToPostLoad = [];
        var appendScriptToBody = window.appendScriptToBody = function (src) { 
            _scriptsToPostLoad.push(src);
        };
        //running local helper
        var isRunningLocal = window.isRunningLocal =
            (window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1");
    </script>

    
    <script type="text/javascript">
        if ((!window.isRunningLocal) && (window.location.protocol != "https:"))
            window.location.protocol = "https";
    </script>
    


    <!-- Google Analytics -->
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  if (!window.isRunningLocal) {
    ga('create', 'UA-25639902-1', 'auto');
    ga('send', 'pageview');
  }
</script>



<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Ira Mellor (dot) Com" type="application/atom+xml">
</head>


<body id="top">

    <!-- Header -->
    <header id="header">
  <div class="inner">
    <a href="/" class="image avatar"><img src="/images/me.jpg" alt="Ira Mellor" /></a>
    <h1><strong>Ira Mellor (dot) Com</strong>&nbsp;A developer in the Tampa Bay area of Florida.</h1>
    <ul class="alt menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/archives">Archives</a></li>
      
      <li><a href="/about">About</a></li>
      
      <li><a href="https://twitter.com/direct_messages/create/rollemira">Contact</a></li>
      
      <li><a href="/assets/resume.pdf">Resume</a></li>
      
    </ul>
  </div>
</header>

    <!-- Main -->
		<div id="main">

      <!-- Main Content -->
      
  
  
    
    
      
      
      <section class="archives-wrap">
        <div class="archive-year">
          <a href="/archives/2016" class="archive-year">2016</a>
        </div>
        <div class="archives">
    
    <article class="archive-article archive-type-post">
  <div class="archive-article-inner">
    <header class="archive-article-header">
      <div class="meta">
  
      <span class="date">
          11/18/2016
      </span>
  

  

  


</div>

      
    <h1 itemprop="name">
        <a href="/2016/11/18/WooCommerce-API-Using-RestSharp-over-HTTP-with-OAuth/">WooCommerce API Using RestSharp Over HTTP With OAuth</a>
      </h1>
  

    </header>

    <div class="article-entry" itemprop="articleBody">
      
        <p>Now after searching <a href="http://nuget.org/">NuGet</a> I saw that there is a C# WooCommerce library out there all ready written called <a href="https://github.com/XiaoFaye/WooCommerce.NET">WooCommerce.NET</a>. This isn’t going to work for me because I will need the ability to gain access to custom Order fields.</p>
<p>So I decided to just use my favorite REST client <a href="http://restsharp.org/">RestSharp</a> to contact a fairly simple REST API for <a href="https://woocommerce.com/">WooCommerce</a>. But I was running into a strange authentication issue and being denied authentication with a 401 status code. </p>
<p><strong>Now, first a disclaimer… DO NOT USE HTTP FOR WooCommerce IN A PRODUCTION ENVIRONMENT!</strong></p>
<p>Ok, but I need to do some testing in a local environmnet so I can see that my code is working properly. Reading the <a href="https://woocommerce.com/">WooCommerce</a> documentation for authentication, <a href="http://woocommerce.github.io/woocommerce-rest-api-docs/#authentication-over-http">which can be found here</a>, it clearly states:</p>
<blockquote>
<p>The OAuth parameters must be added as query string parameters and not included in the Authorization header. This is because there is no reliable cross-platform way to get the raw request headers in WordPress.</p>
</blockquote>
<p>So I do a bit of digging about <a href="http://restsharp.org/">RestSharp</a> and OAuth1.0 and come up <a href="https://github.com/restsharp/RestSharp/blob/master/RestSharp.IntegrationTests/oAuth1Tests.cs">with this suite of tests</a>. Here’s the important bit that I needed:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Can_Authenticate_OAuth1_With_Querystring_Parameters</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> consumerKey = <span class="string">&quot;enterConsumerKeyHere&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> consumerSecret = <span class="string">&quot;enterConsumerSecretHere&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">string</span> baseUrl = <span class="string">&quot;http://restsharp.org&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> expected = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;oauth_consumer_key&quot;</span>,</span><br><span class="line">        <span class="string">&quot;oauth_nonce&quot;</span>,</span><br><span class="line">        <span class="string">&quot;oauth_signature_method&quot;</span>,</span><br><span class="line">        <span class="string">&quot;oauth_timestamp&quot;</span>,</span><br><span class="line">        <span class="string">&quot;oauth_version&quot;</span>,</span><br><span class="line">        <span class="string">&quot;oauth_signature&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    RestClient client = <span class="keyword">new</span> RestClient(baseUrl);</span><br><span class="line">    RestRequest request = <span class="keyword">new</span> RestRequest(Method.GET);</span><br><span class="line">    <span class="keyword">var</span> authenticator = OAuth1Authenticator.ForRequestToken(consumerKey, consumerSecret);</span><br><span class="line">    authenticator.ParameterHandling = OAuthParameterHandling.UrlOrPostParameters;</span><br><span class="line">    authenticator.Authenticate(client, request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> requestUri = client.BuildUri(request);</span><br><span class="line">    <span class="keyword">var</span> actual = HttpUtility.ParseQueryString(requestUri.Query).AllKeys.ToList();</span><br><span class="line"></span><br><span class="line">    Assert.IsTrue(actual.SequenceEqual(expected));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The above Authenticate method will do all the work and add all the parameters I need.</p>
<p>But wait… Something’s not right here. In the debugger it shows me that the parameters on the request are being added as cookes:</p>
<img src="https://iramellor.com/images/20161110_OAuth.jpg" alt="Visual Studio Debugger" />

<p>Strange, but ok. So I decided to make an extension method that does all the authentication, gets all the parameters added to the request, and then converts them to QueryString parameters.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">RestRequestExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RestRequest <span class="title">BuildOAuth1QueryString</span>(<span class="params"><span class="keyword">this</span> RestRequest request, RestClient client, <span class="built_in">string</span> consumerKey, <span class="built_in">string</span> consumerSecret</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> auth = OAuth1Authenticator.ForRequestToken(consumerKey, consumerSecret);</span><br><span class="line">        auth.ParameterHandling = OAuthParameterHandling.UrlOrPostParameters;</span><br><span class="line">        auth.Authenticate(client, request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//convert all these oauth params from cookie to querystring</span></span><br><span class="line">        request.Parameters.ForEach(x =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (x.Name.StartsWith(<span class="string">&quot;oauth_&quot;</span>))</span><br><span class="line">                x.Type = ParameterType.QueryString;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> request;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So the code to build a request now looks something like this.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> RestClient(<span class="string">&quot;http://example.com/api/v1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> request = <span class="keyword">new</span> RestRequest(<span class="string">&quot;/path/to/resource&quot;</span>);</span><br><span class="line">request.BuildOAuth1QueryString(client, <span class="string">&quot;&#123;consumer_key&#125;&quot;</span>, <span class="string">&quot;&#123;consumer_secret&#125;&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> response = client.Execute(request);</span><br></pre></td></tr></table></figure>
<p>And there we have it. Talking to <a href="https://woocommerce.com/">WooCommerce</a> with <a href="http://restsharp.org/">RestSharp</a>.</p>
<h2 id="For-Production"><a href="#For-Production" class="headerlink" title="For Production"></a>For Production</h2><p><strong>I can not stress enough to not communicate over HTTP in production.</strong> In production, you should be using HTTPS. In that case <a href="http://woocommerce.github.io/woocommerce-rest-api-docs/#authentication-over-https">you can use HTTP Basic Authentication</a>. Then you will no longer need the BuildOAuth1QueryString extension method, you would simply add the Basic Authentication to the client like so:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Basic over Https</span></span><br><span class="line">client.Authenticator = <span class="keyword">new</span> HttpBasicAuthenticator(<span class="string">&quot;&#123;consumer_key&#125;&quot;</span>, <span class="string">&quot;&#123;consumer_secret&#125;&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>Hope this helps!</p>

      
      
      <a class="article-comments" href="/2016/11/18/WooCommerce-API-Using-RestSharp-over-HTTP-with-OAuth/#disqus_thread">View Comments</a>
      
      


<div class="tags">
    <a href="/tags/code/" class="button small">code</a> <a href="/tags/net/" class="button small">.net</a> <a href="/tags/c/" class="button small">c#</a> <a href="/tags/rest/" class="button small">rest</a>
</div>

    </div>
  </div>
</article>

  
    
    
      
        </div></section>
      
      
      <section class="archives-wrap">
        <div class="archive-year">
          <a href="/archives/2009" class="archive-year">2009</a>
        </div>
        <div class="archives">
    
    <article class="archive-article archive-type-post">
  <div class="archive-article-inner">
    <header class="archive-article-header">
      <div class="meta">
  
      <span class="date">
          04/27/2009
      </span>
  

  

  


</div>

      
    <h1 itemprop="name">
        <a href="/2009/04/27/The-HttpWebRequest-and-Using-Client-Certificates/">The HttpWebRequest and Using Client Certificates</a>
      </h1>
  

    </header>

    <div class="article-entry" itemprop="articleBody">
      
        <p>So you may have found yourself in a similar situation, needing to make a TCP&#x2F;IP request to a 3rd party API possibly using SSL. Well, that is a quite simple task. It can however, be complicated if this 3rd party requires the use of certificates for communication to its API server. I found myself in some sort of certificate hell where I had the certificate, added it to the request and somehow it still wasn’t working. If you know what I’m talking about and had as many hurdles as I did, my condolences to you. I will try to explain in this article how I started, the problems I ran into and then the overall solution that ended up working for me. </p>
<p>To start with, you should have some kind of certificate. Most likely a *.pfx or *.p12 file. This can also come with a private key or password for the certificate’s encryption. This is what a standard WebRequest over SSL might look like:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetData</span>(<span class="params"><span class="built_in">string</span> inputData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//will hold the result</span></span><br><span class="line">    <span class="built_in">string</span> result = <span class="built_in">string</span>.Empty;</span><br><span class="line">    <span class="comment">//build the request object</span></span><br><span class="line">    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(<span class="string">&quot;https://someapi.com/&quot;</span>);</span><br><span class="line">    <span class="comment">//write the input data (aka post) to a byte array</span></span><br><span class="line">    <span class="built_in">byte</span>[] requestBytes = <span class="keyword">new</span> ASCIIEncoding().GetBytes(inputData);</span><br><span class="line">    <span class="comment">//get the request stream to write the post to</span></span><br><span class="line">    Stream requestStream = request.GetRequestStream();</span><br><span class="line">    <span class="comment">//write the post to the request stream</span></span><br><span class="line">    requestStream.Write(requestBytes, <span class="number">0</span>, requestBytes.Length);</span><br><span class="line">    <span class="comment">//build a response object to hold the response</span></span><br><span class="line">    <span class="comment">//submit the request by calling get response</span></span><br><span class="line">    HttpWebResponse response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">    <span class="comment">//get the response stream to read the response from</span></span><br><span class="line">    Stream responseStream = response.GetResponseStream();</span><br><span class="line">    <span class="comment">//now read it out to our result</span></span><br><span class="line">    <span class="keyword">using</span> (StreamReader rdr = <span class="keyword">new</span> StreamReader(responseStream))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//set the result to the contents of the stream</span></span><br><span class="line">        result = rdr.ReadToEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//return</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The example above is missing the portion where you add the certificate to the request. You may receive a 403 Forbidden error from the server if a certificate is required to make the request to the API server. A simple way of adding a certificate to the request would be like so:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//add certificate to the request</span></span><br><span class="line">request.ClientCertificates.Add(<span class="keyword">new</span> X509Certificate(<span class="string">@&quot;C:\certs\Some Cert.p12&quot;</span>, <span class="string">@&quot;SecretP@$$w0rd&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>The X509Certificate class is found in the System.Security.Cryptography.X509Certificates namespace. Simply add a new certificate to the client certificates before calling for the response, and it <strong>should</strong> be sent with the request. However, you may encounter an exception with the message “The system cannot find the file specified”. I encountered this error after I got the application off my local machine and onto the development server. After doing some research I stumbled upon this <a href="http://support.microsoft.com/kb/948154">kb article</a>. This article opened my eyes to how using certificates is a little more complicated than I initially thought. Turns out the problem was that the user trying to access the certificate does not have a profile loaded.</p>
<p>After stepping through the article, installing the certificate to the local machine’s personal certificate store, and then granting rights to the certificate using the <a href="http://www.microsoft.com/downloads/details.aspx?familyid=c42e27ac-3409-40e9-8667-c748e422833f&amp;displaylang=en">WinHttpCertCfg.exe</a> tool, and putting in a little more code found in the kb article, I was well on my way. The article describes how to use C# to open a certificate store and use the certificate directly out of the store. This presents a bit more elegant, and in my opinion more secure, way of getting to and using the certificate.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//add it in a better way</span></span><br><span class="line">X509Store certStore = <span class="keyword">new</span> X509Store(<span class="string">&quot;My&quot;</span>, StoreLocation.LocalMachine);</span><br><span class="line">certStore.Open(OpenFlags.ReadOnly | OpenFlags.OpenExistingOnly);</span><br><span class="line">X509Certificate2 cert = certStore.Certificates.Find(X509FindType.FindBySubjectName, <span class="string">&quot;My cert subject&quot;</span>, <span class="literal">false</span>)[<span class="number">0</span>];</span><br><span class="line">certStore.Close();</span><br><span class="line">request.ClientCertificates.Add(cert);</span><br></pre></td></tr></table></figure>
<p>This method will not only give access to the certificate regardless of having a loaded profile, but it also takes the certificate’s private key password out of the code and&#x2F;or configuration. This snippet above took me out of the certificate hell that was crushing my life for a couple days! </p>
<p>Putting it all together:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetData</span>(<span class="params"><span class="built_in">string</span> inputData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//will hold the result</span></span><br><span class="line">    <span class="built_in">string</span> result = <span class="built_in">string</span>.Empty;</span><br><span class="line">    <span class="comment">//build the request object</span></span><br><span class="line">    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(<span class="string">&quot;https://someapi.com/&quot;</span>);</span><br><span class="line">    <span class="comment">//add certificate to the request</span></span><br><span class="line">    <span class="comment">//request.ClientCertificates.Add(new X509Certificate(@&quot;C:\certs\Some Cert.p12&quot;, @&quot;SecretP@$$w0rd&quot;));</span></span><br><span class="line">    <span class="comment">//add it in a better way</span></span><br><span class="line">    X509Store certStore = <span class="keyword">new</span> X509Store(<span class="string">&quot;My&quot;</span>, StoreLocation.LocalMachine);</span><br><span class="line">    certStore.Open(OpenFlags.ReadOnly | OpenFlags.OpenExistingOnly);</span><br><span class="line">    X509Certificate2 cert = certStore.Certificates.Find(X509FindType.FindBySubjectName, <span class="string">&quot;My cert subject&quot;</span>, <span class="literal">false</span>)[<span class="number">0</span>];</span><br><span class="line">    certStore.Close();</span><br><span class="line">    request.ClientCertificates.Add(cert);</span><br><span class="line">    <span class="comment">//write the input data (aka post) to a byte array</span></span><br><span class="line">    <span class="built_in">byte</span>[] requestBytes = <span class="keyword">new</span> ASCIIEncoding().GetBytes(inputData);</span><br><span class="line">    <span class="comment">//get the request stream to write the post to</span></span><br><span class="line">    Stream requestStream = request.GetRequestStream();</span><br><span class="line">    <span class="comment">//write the post to the request stream</span></span><br><span class="line">    requestStream.Write(requestBytes, <span class="number">0</span>, requestBytes.Length);</span><br><span class="line">    <span class="comment">//build a response object to hold the response</span></span><br><span class="line">    <span class="comment">//submit the request by calling get response</span></span><br><span class="line">    HttpWebResponse response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">    <span class="comment">//get the response stream to read the response from</span></span><br><span class="line">    Stream responseStream = response.GetResponseStream();</span><br><span class="line">    <span class="comment">//now read it out to our result</span></span><br><span class="line">    <span class="keyword">using</span> (StreamReader rdr = <span class="keyword">new</span> StreamReader(responseStream))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//set the result to the contents of the stream</span></span><br><span class="line">        result = rdr.ReadToEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//return</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Hope this helps!</p>

      
      
      <a class="article-comments" href="/2009/04/27/The-HttpWebRequest-and-Using-Client-Certificates/#disqus_thread">View Comments</a>
      
      


<div class="tags">
    <a href="/tags/code/" class="button small">code</a> <a href="/tags/net/" class="button small">.net</a> <a href="/tags/c/" class="button small">c#</a>
</div>

    </div>
  </div>
</article>

  
    
    
      
        </div></section>
      
      
      <section class="archives-wrap">
        <div class="archive-year">
          <a href="/archives/2008" class="archive-year">2008</a>
        </div>
        <div class="archives">
    
    <article class="archive-article archive-type-post">
  <div class="archive-article-inner">
    <header class="archive-article-header">
      <div class="meta">
  
      <span class="date">
          10/08/2008
      </span>
  

  

  


</div>

      
    <h1 itemprop="name">
        <a href="/2008/10/08/The-private-access-modifier-can-do-that/">The Private Access Modifier Can Do That?</a>
      </h1>
  

    </header>

    <div class="article-entry" itemprop="articleBody">
      
        <p>If you look up accessibility levels on the <a href="http://msdn.microsoft.com/en-us/library/ba0a1yw2%28VS.80%29.aspx">MSDN web site, it will tell you that the accessibility of the private access modifier is limited to the containing type</a>. I ran into an instance that showed me the direct meaning of this statement. The scenario I had was this: I wanted to have the ability to make an object read only. That is the original object however, if a clone was made then the object could be modified again because it wasn’t the original object. Of course this is a simple task, we get to go back and visit my good friend ICloneable.</p>
<p>So we start off by making our data object, putting in the ability to mark it read only and giving it the ability to clone itself. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Lion</span> : <span class="title">ICloneable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Lion</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Lion</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _isReadOnly;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsReadOnly</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _isReadOnly; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _name; &#125;</span><br><span class="line">        <span class="keyword">set</span> </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_isReadOnly)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ReadOnlyException(<span class="string">&quot;This object is read only&quot;</span>);</span><br><span class="line">            _name = <span class="keyword">value</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MakeReadOnly</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _isReadOnly = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">region</span> ICloneable Members</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Lion <span class="title">Clone</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Lion result = (Lion)((ICloneable)<span class="keyword">this</span>).Clone();</span><br><span class="line">        result._isReadOnly = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">object</span> ICloneable.Clone()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.MemberwiseClone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Take a look at line #43 above. During the cloning process, you can set the private variable _isReadOnly on the newly cloned object! </p>
<p>For some reason, I was under the impression that any and all private fields and methods were private to that instance of the object. This would mean that all private members of the cloned object would have to be called in the cloned object. To my surprise, this is not the case at all. After changing the _isReadOnly field of the cloned object, the object that was cloned will still remain read only. The cloned object will remain editable until the MakeReadOnly() method is called on it.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>All fields and methods with the private access modifier are exposed at any time as long as you are in the containing type. The implications of this are that if you clone an object you will have access to the private members of the newly created object. This can be extremely useful, especially if you want a specific action to be performed on a cloned object but you don’t want to explicitly call that action publicly.</p>
<p>Hope this helps!</p>

      
      
      <a class="article-comments" href="/2008/10/08/The-private-access-modifier-can-do-that/#disqus_thread">View Comments</a>
      
      


<div class="tags">
    <a href="/tags/code/" class="button small">code</a> <a href="/tags/net/" class="button small">.net</a> <a href="/tags/c/" class="button small">c#</a>
</div>

    </div>
  </div>
</article>

  
    
    
      
        </div></section>
      
      
      <section class="archives-wrap">
        <div class="archive-year">
          <a href="/archives/2008" class="archive-year">2008</a>
        </div>
        <div class="archives">
    
    <article class="archive-article archive-type-post">
  <div class="archive-article-inner">
    <header class="archive-article-header">
      <div class="meta">
  
      <span class="date">
          08/26/2008
      </span>
  

  

  


</div>

      
    <h1 itemprop="name">
        <a href="/2008/08/26/LINQ-Distinct-a-DataTable-and-the-IEqualityComparer/">LINQ Distinct, a DataTable and the IEqualityComparer</a>
      </h1>
  

    </header>

    <div class="article-entry" itemprop="articleBody">
      
        <p>In a recent situation I was trying to pull some aggregates out of a DataTable using LINQ. I needed to get the rows of the DataTable with a Distinct clause, but my aggregates would be on other columns of the row. The problem is that when you call LINQ’s Distinct() extension method with no arguments, it uses the &quot;default IEqualityComparer&quot;. This means that it will work if you use the Select() extension method, only returning the column you want the distinct on. Well that works great, unless you need more columns from the DataTable.</p>
<p>The solution here is simple. Write a custom DataRow comparer that compares the DataRow against the column you are trying to put the distinct on. Here is an example:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonDataRowComparer</span> : <span class="title">IEqualityComparer</span>&lt;<span class="title">DataRow</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">region</span> IEqualityComparer&lt;DataRow&gt; Members</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Equals</span>(<span class="params">DataRow x, DataRow y</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (x.Field&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;PersonID&quot;</span>) == y.Field&lt;<span class="built_in">int</span>&gt;(<span class="string">&quot;PersonID&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetHashCode</span>(<span class="params">DataRow obj</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> obj.ToString().GetHashCode();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Once we inherit IEqualityComparer&lt;T&gt; (T being the type we want to do the comparison on) all we do is fill in the Equals() and the GetHashCode() methods. In the Equals() method, we just tell the DataRows to compare the fields &quot;PersonID&quot; and return if they are equal. This will tell LINQ if the DataRow is distinct or not.</p>
<p>Hope this helps!</p>

      
      
      <a class="article-comments" href="/2008/08/26/LINQ-Distinct-a-DataTable-and-the-IEqualityComparer/#disqus_thread">View Comments</a>
      
      


<div class="tags">
    <a href="/tags/code/" class="button small">code</a> <a href="/tags/net/" class="button small">.net</a> <a href="/tags/linq/" class="button small">linq</a> <a href="/tags/c/" class="button small">c#</a>
</div>

    </div>
  </div>
</article>

  
    
    
      
        </div></section>
      
      
      <section class="archives-wrap">
        <div class="archive-year">
          <a href="/archives/2008" class="archive-year">2008</a>
        </div>
        <div class="archives">
    
    <article class="archive-article archive-type-post">
  <div class="archive-article-inner">
    <header class="archive-article-header">
      <div class="meta">
  
      <span class="date">
          06/03/2008
      </span>
  

  

  


</div>

      
    <h1 itemprop="name">
        <a href="/2008/06/03/Strongly-Typed-Dynamic-User-Controls/">Strongly Typed Dynamic User Controls</a>
      </h1>
  

    </header>

    <div class="article-entry" itemprop="articleBody">
      
        <p>A short time ago I was confronted with a serious problem. What I needed to do was dynamically choose a UserControl as well as fire methods from that UserControl. The problem lies in the fact that a UserControl does not implement my custom methods that I needed for my controls. Each control was similar and would have the same methods but it would have different display characteristics.</p>
<p>That was when I had a small epiphany. Why can’t I just make an abstract base class? Well the answer is you can! Sometimes I am prone to forget how .NET allows me to customize pre-defined classes. What we can do is create an abstract base class that inherits the UserControl class, then have our UserControls inherit from our base class.</p>
<p>First we will create our abstract base class.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System.Configuration;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.Security;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.HtmlControls;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls.WebParts;</span><br><span class="line"><span class="keyword">using</span> System.Xml.Linq;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Base class to be inherited by a UserControl that displays the date</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">DateTimeDisplayControl</span> : <span class="title">UserControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Updates the date time inside the user control.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">UpdateDateTime</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So in the snippet above, we have created a class called DateTimeDisplayControl. This inherits from UserControl and will have to override the abstract method UpdateDateTime().</p>
<p>Now we can create a couple of UserControls that inherit from our DisplayDateTimeControl class. The first control will be called &quot;ControlOne&quot;.</p>
<p>Here is the *.ascx code:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Control Language=&quot;C#&quot; AutoEventWireup=&quot;true&quot; CodeFile=&quot;ControlOne.ascx.cs&quot; Inherits=&quot;UserControls_ControlOne&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>User control one<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">asp:UpdatePanel</span> <span class="attr">ID</span>=<span class="string">&quot;udp1&quot;</span>  <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">UpdateMode</span>=<span class="string">&quot;Conditional&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ContentTemplate</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asp:Label</span> <span class="attr">ID</span>=<span class="string">&quot;lblDateTime&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ContentTemplate</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">asp:UpdatePanel</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Here is the code behind:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Configuration;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.Security;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.HtmlControls;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls.WebParts;</span><br><span class="line"><span class="keyword">using</span> System.Xml.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">UserControls_ControlOne</span> : <span class="title">DateTimeDisplayControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!Page.IsPostBack)</span><br><span class="line">            UpdateDateTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">UpdateDateTime</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        lblDateTime.Text = DateTime.Now.ToString();</span><br><span class="line">        udp1.Update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you can see, ControlOne contains an UpdatePanel with a Label inside of it. The Label will display the date and time. We will call our second control &quot;ControlTwo&quot; and it will look exactly like ControlOne, only it will say &quot;User control two&quot; inside of it.</p>
<p>Now we will create the actual *.aspx page to display the controls.</p>
<p>Here is the *.aspx code</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=&quot;C#&quot; AutoEventWireup=&quot;true&quot;  CodeFile=&quot;Default.aspx.cs&quot; Inherits=&quot;_Default&quot; %&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml<span class="symbol">&amp;quot;</span>&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">&lt;head runat=&quot;</span><span class="attr">server</span>&quot;&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Strongly Typed Dynamic User Controls<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;form1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asp:ScriptManager</span> <span class="attr">ID</span>=<span class="string">&quot;sm1&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">asp:UpdatePanel</span> <span class="attr">ID</span>=<span class="string">&quot;udp&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">UpdateMode</span>=<span class="string">&quot;Conditional&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ContentTemplate</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">asp:Panel</span> <span class="attr">ID</span>=<span class="string">&quot;pnlContent&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ContentTemplate</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Triggers</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">asp:AsyncPostBackTrigger</span> <span class="attr">ControlID</span>=<span class="string">&quot;btnUseControlOne&quot;</span> <span class="attr">EventName</span>=<span class="string">&quot;Click&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">asp:AsyncPostBackTrigger</span> <span class="attr">ControlID</span>=<span class="string">&quot;btnUseControlTwo&quot;</span> <span class="attr">EventName</span>=<span class="string">&quot;Click&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">asp:AsyncPostBackTrigger</span> <span class="attr">ControlID</span>=<span class="string">&quot;btnUpdateDateTime&quot;</span> <span class="attr">EventName</span>=<span class="string">&quot;Click&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Triggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">asp:UpdatePanel</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">asp:Button</span> <span class="attr">ID</span>=<span class="string">&quot;btnUseControlOne&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;Use Control One&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">onclick</span>=<span class="string">&quot;btnUseControlOne_Click&quot;</span> /&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">asp:Button</span> <span class="attr">ID</span>=<span class="string">&quot;btnUseControlTwo&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;Use Control Two&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">onclick</span>=<span class="string">&quot;btnUseControlTwo_Click&quot;</span> /&gt;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">asp:Button</span> <span class="attr">ID</span>=<span class="string">&quot;btnUpdateDateTime&quot;</span> <span class="attr">runat</span>=<span class="string">&quot;server&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;Update Content&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">onclick</span>=<span class="string">&quot;btnUpdateDateTime_Click&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Here is the code behind:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Configuration;</span><br><span class="line"><span class="keyword">using</span> System.Data;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.Security;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.HtmlControls;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls;</span><br><span class="line"><span class="keyword">using</span> System.Web.UI.WebControls.WebParts;</span><br><span class="line"><span class="keyword">using</span> System.Xml.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> _<span class="title">Default</span> : <span class="title">System.Web.UI.Page</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _controlVirtualPath = <span class="built_in">string</span>.Empty;</span><br><span class="line">    <span class="keyword">private</span> DateTimeDisplayControl _DateTimeDisplayControl = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> ControlVirtualPath</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(_controlVirtualPath))</span><br><span class="line">                _controlVirtualPath = ViewState[<span class="string">&quot;ControlVirtualPath&quot;</span>].ToString();</span><br><span class="line">            ViewState[<span class="string">&quot;ControlVirtualPath&quot;</span>] = _controlVirtualPath;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(_controlVirtualPath))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationException(<span class="string">&quot;The control virtual path was not found&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _controlVirtualPath;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DateTimeDisplayControl LoadedAjaxControl</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_DateTimeDisplayControl == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _DateTimeDisplayControl = (DateTimeDisplayControl)Page.LoadControl(ControlVirtualPath);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _DateTimeDisplayControl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadAndDisplayUserControl</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        pnlContent.Controls.Add(LoadedAjaxControl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">LoadAndDisplayUserControl</span>(<span class="params"><span class="built_in">string</span> controlVirtualPath</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _controlVirtualPath = controlVirtualPath;</span><br><span class="line">        pnlContent.Controls.Add(LoadedAjaxControl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!Page.IsPostBack)</span><br><span class="line">            LoadAndDisplayUserControl(<span class="string">&quot;~/UserControls/ControlOne.ascx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">btnUseControlOne_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadAndDisplayUserControl(<span class="string">&quot;~/UserControls/ControlOne.ascx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">btnUseControlTwo_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadAndDisplayUserControl(<span class="string">&quot;~/UserControls/ControlTwo.ascx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">btnUpdateDateTime_Click</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadAndDisplayUserControl();</span><br><span class="line">        LoadedAjaxControl.UpdateDateTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you may see, the *.aspx page will load up ControlOne by default. There are 3 buttons on the page that will allow you to swap out ControlOne and ControlTwo as well as call the UpdateDateTime() method of the controls.</p>
<p>That is all there is to it! One important note is that I am using a private property to get the loaded control, this is important to note because you will need to call that UpdateDateTime() method on the instance of the control that you rendered to the page. I don’t know why I didn’t think of this long ago, but I hope you will find it as useful as I did!</p>
<p>Happy coding!</p>

      
      
      <a class="article-comments" href="/2008/06/03/Strongly-Typed-Dynamic-User-Controls/#disqus_thread">View Comments</a>
      
      


<div class="tags">
    <a href="/tags/code/" class="button small">code</a> <a href="/tags/asp-net/" class="button small">asp.net</a> <a href="/tags/net/" class="button small">.net</a> <a href="/tags/c/" class="button small">c#</a>
</div>

    </div>
  </div>
</article>

  
    
    
      
        </div></section>
      
      
      <section class="archives-wrap">
        <div class="archive-year">
          <a href="/archives/2008" class="archive-year">2008</a>
        </div>
        <div class="archives">
    
    <article class="archive-article archive-type-post">
  <div class="archive-article-inner">
    <header class="archive-article-header">
      <div class="meta">
  
      <span class="date">
          04/21/2008
      </span>
  

  

  


</div>

      
    <h1 itemprop="name">
        <a href="/2008/04/21/Using-The-Event-Model-Throwing-and-Handling-Custom-Events/">Using the Event Model: Throwing and Handling Custom Events</a>
      </h1>
  

    </header>

    <div class="article-entry" itemprop="articleBody">
      
        <p>If you haven’t tried using the event model in .NET you don’t know what you’re missing. If this is the case, then I’m glad you’re here. Events are a very nice way to add flexibility to your projects and eliminate cross cutting concerns. You can use them for a variety of things including validation and logging. You can think of an event as sort of an All Points Bulletin (APB) throughout your application. Once you declare and throw an event, every place in your code that has an event handler for that event will be executed. Events can be both static or per instance. You use events every time you build an ASP.NET website. The Page_Load event, Button_Click event, etc… It is like an application wide notification that something is happening. </p>
<p>An important note is that all event handlers that have been moved to the call stack will be fired. So when you call out to your custom event, all objects that are in the call stack with an event handler for that event will be fired. Another thing to keep in mind is that there is no guaranteed order in which the events will be fired. If you are in need of doing something that requires a specific order, you should use more events or take another approach entirely. </p>
<p>In this project, we will create some events and handle them in a logging system. The first thing we will need to do is set up an event delegate to strongly type our event. Along with doing that, I like to setup some custom event arguments that will take in the object(s) that I will be dealing with during the event. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System; <span class="keyword">using</span> System.Collections.Generic; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//Delegate for a PersonEvent </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">PersonEvent</span>(<span class="params">PersonEventArgs e</span>)</span>; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonEventArgs</span> : <span class="title">EventArgs</span> </span><br><span class="line">&#123;     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonEventArgs</span>()</span>     </span><br><span class="line">    &#123;              </span><br><span class="line">    </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonEventArgs</span>(<span class="params">Person person</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="keyword">this</span>.Person = person;     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonEventArgs</span>(<span class="params">List&lt;Person&gt; personList</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="keyword">this</span>.PersonList = personList;     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Person the action will be on     </span></span><br><span class="line">    <span class="keyword">public</span> Person Person &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//List of person the action will be on     </span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Person&gt; PersonList &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//For canceling action     </span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> Cancel &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ok, Now all we have to do is declare and throw our events. When declaring our events, they will be of the type PersonEvent. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic; </span><br><span class="line"><span class="keyword">using</span> System.ComponentModel; </span><br><span class="line"> </span><br><span class="line">[<span class="meta">DataObject(true)</span>] </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonBLL</span> </span><br><span class="line">&#123;     </span><br><span class="line">    <span class="comment">//Declare events     </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Pre_Get;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Post_Get;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Pre_Insert;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Post_Insert;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Pre_Update;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Post_Update;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Pre_Delete;     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> PersonEvent Post_Delete;     </span><br><span class="line">    </span><br><span class="line">    [<span class="meta">DataObjectMethod(DataObjectMethodType.Select)</span>]     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;PersonPresentationShell&gt; <span class="title">GetPeople</span>()</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Pre_Get != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs();             </span><br><span class="line">            Pre_Get(<span class="keyword">args</span>);             </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">args</span>.Cancel) <span class="keyword">return</span> <span class="literal">null</span>;         </span><br><span class="line">        &#125;         </span><br><span class="line">        </span><br><span class="line">        List&lt;PersonPresentationShell&gt; result = <span class="keyword">new</span> List&lt;PersonPresentationShell&gt;();         </span><br><span class="line">        List&lt;Person&gt; personList = DataAccessFactory.GetPeople();         </span><br><span class="line">        <span class="keyword">foreach</span> (Person item <span class="keyword">in</span> personList)         </span><br><span class="line">        &#123;             </span><br><span class="line">            result.Add(<span class="keyword">new</span> PersonPresentationShell(item));         </span><br><span class="line">        &#125;         </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Post_Get != <span class="literal">null</span>)         </span><br><span class="line">        &#123;           </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(personList);             </span><br><span class="line">            Post_Get(<span class="keyword">args</span>);             </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">args</span>.Cancel) <span class="keyword">return</span> <span class="literal">null</span>;         </span><br><span class="line">        &#125;         </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    [<span class="meta">DataObjectMethod(DataObjectMethodType.Update)</span>]     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdatePerson</span>(<span class="params">PersonPresentationShell p</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Pre_Update != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(p.Person);             </span><br><span class="line">            Pre_Update(<span class="keyword">args</span>);             </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">args</span>.Cancel) <span class="keyword">return</span>;         </span><br><span class="line">        &#125;         </span><br><span class="line">        </span><br><span class="line">        DataAccessFactory.UpdatePerson(p.Person);         </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Post_Update != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(p.Person);             </span><br><span class="line">            Post_Update(<span class="keyword">args</span>);         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    [<span class="meta">DataObjectMethod(DataObjectMethodType.Delete)</span>]     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DeletePerson</span>(<span class="params">PersonPresentationShell p</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Pre_Delete != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(p.Person);             </span><br><span class="line">            Pre_Delete(<span class="keyword">args</span>);             </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">args</span>.Cancel) <span class="keyword">return</span>;         </span><br><span class="line">        &#125;         </span><br><span class="line">        </span><br><span class="line">        DataAccessFactory.DeletePerson(p.Person);         </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Post_Delete != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(p.Person);             </span><br><span class="line">            Post_Delete(<span class="keyword">args</span>);         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    [<span class="meta">DataObjectMethod(DataObjectMethodType.Insert)</span>]     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InsertPerson</span>(<span class="params">PersonPresentationShell p</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Pre_Insert != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(p.Person);             </span><br><span class="line">            Pre_Insert(<span class="keyword">args</span>);             </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">args</span>.Cancel) <span class="keyword">return</span>;         </span><br><span class="line">        &#125;         </span><br><span class="line">        </span><br><span class="line">        DataAccessFactory.InsertPerson(p.Person);         </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Call out to event handler         </span></span><br><span class="line">        <span class="keyword">if</span> (Post_Insert != <span class="literal">null</span>)         </span><br><span class="line">        &#123;             </span><br><span class="line">            PersonEventArgs <span class="keyword">args</span> = <span class="keyword">new</span> PersonEventArgs(p.Person);             </span><br><span class="line">            Post_Insert(<span class="keyword">args</span>);         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There we have it! An event will now be thrown before and after every get, insert, update and delete. Now we have to set up some event handlers in our logging object. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System; </span><br><span class="line"><span class="keyword">using</span> System.IO; </span><br><span class="line"><span class="keyword">using</span> System.Web; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Logger</span> </span><br><span class="line">&#123;     </span><br><span class="line">    <span class="comment">//Set the log file location     </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> _logFileLocation = HttpContext.Current.Server.MapPath(<span class="string">&quot;~/App_Data/logfile.log&quot;</span>);     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="title">Logger</span>()</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        <span class="comment">//Attach event handlers         </span></span><br><span class="line">        PersonBLL.Pre_Delete += <span class="keyword">new</span> PersonEvent(PersonBLL_Pre_Delete);         </span><br><span class="line">        PersonBLL.Post_Delete += <span class="keyword">new</span> PersonEvent(PersonBLL_Post_Delete);         </span><br><span class="line">        PersonBLL.Pre_Get += <span class="keyword">new</span> PersonEvent(PersonBLL_Pre_Get);         </span><br><span class="line">        PersonBLL.Post_Get += <span class="keyword">new</span> PersonEvent(PersonBLL_Post_Get);         </span><br><span class="line">        PersonBLL.Pre_Insert += <span class="keyword">new</span> PersonEvent(PersonBLL_Pre_Insert);         </span><br><span class="line">        PersonBLL.Post_Insert += <span class="keyword">new</span> PersonEvent(PersonBLL_Post_Insert);         </span><br><span class="line">        PersonBLL.Pre_Update += <span class="keyword">new</span> PersonEvent(PersonBLL_Pre_Update);         </span><br><span class="line">        PersonBLL.Post_Update += <span class="keyword">new</span> PersonEvent(PersonBLL_Post_Update);     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PersonBLL_Post_Update</span>(<span class="params">PersonEventArgs e</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        WriteToLogFile(<span class="string">&quot;PersonId: &quot;</span> + e.Person.PersonId.ToString() + <span class="string">&quot; - &quot;</span> + e.Person.FirstName + <span class="string">&quot; &quot;</span> + e.Person.LastName </span><br><span class="line">            + <span class="string">&quot; was updated”);     </span></span><br><span class="line"><span class="string">    &#125;     </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    static void PersonBLL_Pre_Update(PersonEventArgs e)     </span></span><br><span class="line"><span class="string">    &#123;         </span></span><br><span class="line"><span class="string">        WriteToLogFile(&quot;</span>PersonId: <span class="string">&quot; + e.Person.PersonId.ToString() + &quot;</span> - <span class="string">&quot; + e.Person.FirstName + &quot;</span> <span class="string">&quot; + e.Person.LastName </span></span><br><span class="line"><span class="string">            + &quot;</span> <span class="keyword">is</span> about to be updated”);     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PersonBLL_Post_Insert</span>(<span class="params">PersonEventArgs e</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        WriteToLogFile(<span class="string">&quot;PersonId: &quot;</span> + e.Person.PersonId.ToString() + <span class="string">&quot; - &quot;</span> + e.Person.FirstName + <span class="string">&quot; &quot;</span> + e.Person.LastName </span><br><span class="line">            + <span class="string">&quot; was inserted”);     </span></span><br><span class="line"><span class="string">    &#125;     </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    static void PersonBLL_Pre_Insert(PersonEventArgs e)     </span></span><br><span class="line"><span class="string">    &#123;         </span></span><br><span class="line"><span class="string">        WriteToLogFile(&quot;</span>PersonId: <span class="string">&quot; + e.Person.PersonId.ToString() + &quot;</span> - <span class="string">&quot; + e.Person.FirstName + &quot;</span> <span class="string">&quot; + e.Person.LastName </span></span><br><span class="line"><span class="string">            + &quot;</span> <span class="keyword">is</span> about to be inserted”);     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PersonBLL_Post_Get</span>(<span class="params">PersonEventArgs e</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        WriteToLogFile(<span class="string">&quot;The people were gotten”);     </span></span><br><span class="line"><span class="string">    &#125;     </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    static void PersonBLL_Pre_Get(PersonEventArgs e)     </span></span><br><span class="line"><span class="string">    &#123;         </span></span><br><span class="line"><span class="string">        WriteToLogFile(&quot;</span>The people are about to be gotten”);     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PersonBLL_Post_Delete</span>(<span class="params">PersonEventArgs e</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        WriteToLogFile(<span class="string">&quot;PersonId: &quot;</span> + e.Person.PersonId.ToString() + <span class="string">&quot; - &quot;</span> + e.Person.FirstName + <span class="string">&quot; &quot;</span> + e.Person.LastName </span><br><span class="line">            + <span class="string">&quot; was deleted”);     </span></span><br><span class="line"><span class="string">    &#125;     </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    static void PersonBLL_Pre_Delete(PersonEventArgs e)     </span></span><br><span class="line"><span class="string">    &#123;         </span></span><br><span class="line"><span class="string">        WriteToLogFile(&quot;</span>PersonId: <span class="string">&quot; + e.Person.PersonId.ToString() + &quot;</span> - <span class="string">&quot; + e.Person.FirstName + &quot;</span> <span class="string">&quot; + e.Person.LastName </span></span><br><span class="line"><span class="string">            + &quot;</span> <span class="keyword">is</span> about to be deleted”);     </span><br><span class="line">    &#125;     </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">WriteToLogFile</span>(<span class="params"><span class="built_in">string</span> message</span>)</span>     </span><br><span class="line">    &#123;         </span><br><span class="line">        DateTime now = DateTime.Now;         </span><br><span class="line">        <span class="keyword">using</span>(StreamWriter sw = File.AppendText(_logFileLocation))         </span><br><span class="line">        &#123;             </span><br><span class="line">            sw.WriteLine(now.ToString() + <span class="string">&quot; - &quot;</span> + message);         </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Finally, we have to create an instance of our logger class in the Global.asax file to attach our event handlers to our events when the application starts. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Application_Start</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span>  </span><br><span class="line">&#123;     </span><br><span class="line">    <span class="comment">//Create an instance of the logger     </span></span><br><span class="line">    <span class="comment">//To attach event handlers     </span></span><br><span class="line">    Logger logger = <span class="keyword">new</span> Logger(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There we have it. Now on every CRUD operation in our application, a log entry will be written with some data about that action. Once you get the hang of it events become extremely useful. One big instance I like to use it for is authorization of performing an action in a membership and roles scenario. </p>
<p>Hope this helps! </p>

      
      
      <a class="article-comments" href="/2008/04/21/Using-The-Event-Model-Throwing-and-Handling-Custom-Events/#disqus_thread">View Comments</a>
      
      


<div class="tags">
    <a href="/tags/code/" class="button small">code</a> <a href="/tags/net/" class="button small">.net</a> <a href="/tags/c/" class="button small">c#</a>
</div>

    </div>
  </div>
</article>

  
  
    </div></section>
  





      <!-- Three - the contact form is on every page! -->
        <!--<section id="three">-->
                  <!--</section>-->

        <!-- Footer -->
<footer id="footer">
    <div class="inner">

        <ul class="icons">
            
                <li><a href="https://www.linkedin.com/in/iramellor" class="icon fa-linkedin" target="_blank"><span class="label">LinkedIn</span></a></li>
            
            
                <li><a href="https://www.twitter.com/rollemira" class="icon fa-twitter" target="_blank" ><span class="label">Twitter</span></a></li>
            
            
            
                <li><a href="https://www.instagram.com/rollemira" class="icon fa-instagram" target="_blank" ><span class="label">Instagram</span></a></li>
            
            
            
            
                <li><a href="https://www.github.com/rollemira" class="icon fa-github" target="_blank" ><span class="label">GitHub</span></a></li>
            
            
            
            
                <li><a href="https://iramellor.com/atom.xml" class="icon  fa-rss" target="_blank" ><span class="label">RSS</span></a></li>
            
        </ul>

        <ul class="attributions">
            <li>Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
            <li>Hexo Theme: <a href="http://livingos.com/" target="_blank">Tim Hyde</a></li>
            <li>Powered By: <a href="http://hexo.io" target="_blank">Hexo</a></li>
        </ul>

        <div class="disclaimer">
            Disclaimer: Unless otherwise stated or granted, all code downloads or samples from this site are licensed 
            under the <a href="/assets/LICENSE.txt" target="_blank">MIT License</a>.
            <div class="copyright">&copy; Ira Mellor. All rights reserved</div>
        </div>
    </div>
</footer>

        
    </div>

    <!-- After footer scripts -->
    <!-- Scripts -->

<script src="/js/jquery.min.js"></script>

<script src="/js/jquery.poptrox.min.js"></script>

<script src="/js/typeahead.min.js"></script>

<script src="/js/skel.min.js"></script>

<script src="/js/util.min.js"></script>

<!--[if lte IE 8]>

<script src="/js/ie/respond.min.js"></script>

<![endif]-->


<script src="/js/main.min.js"></script>

<!-- Disqus Comments -->

<script>
    (function(local){
        if (local) return;
        var disqus_shortname = 'iramellor';
        window.appendScriptToBody('//' + disqus_shortname + '.disqus.com/count.js');
    })(window.isRunningLocal);
</script>


 
<!-- Go to www.addthis.com/dashboard to customize your tools --> 
<script>
    (function(local){
        if (local) return;
        var pubid = 'imellor';
        window.appendScriptToBody('//s7.addthis.com/js/300/addthis_widget.js#pubid=' + pubid);
    })(window.isRunningLocal);
</script>


<!-- For outdated browsers -->
<script> 
    window.appendScriptToBody('//browser-update.org/update.min.js');
</script>

<script>
function $winPostLoad() {
    for (var i = 0; i < window._scriptsToPostLoad.length; i++) {
        var src = window._scriptsToPostLoad[i];
        var s = document.createElement("script"); 
        s.src = src;
        document.body.appendChild(s);
    }
}
try {document.addEventListener("DOMContentLoaded", $winPostLoad, false)}
catch(e){window.attachEvent("onload", $winPostLoad)}
</script>

</body>
</html>
